<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title>CRM+找商機</title>
    <link rel="stylesheet" type="text/css" href="reset.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico" />

    <!-- font awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
</head>

<body id="body">
    <div style="max-width:1240px;margin:0 auto;">
        <header style="outline:3px solid red;height:16vh;align-content:space-around;justify-content:center;z-index:1;background-color: white;min-width:1240px;position:fixed;-webkit-box-shadow: 0 4px 6px -6px #222; -moz-box-shadow: 0 4px 6px -6px #222;  box-shadow: 0 4px 6px -6px #222;display:flex">
            <div style="outline:5px solid green;">
                <div style="outline:2px solid red;height:15%">
                </div>
                <div class="title textAll" style="outline:2px solid red;height:27%;letter-spacing: 25px;margin:auto;color:#2171c4;margin-right:-25px;">
                    CRM+找商機
                </div>
                <div style="outline:2px solid red;height:15%">
                </div>
                <div style="height:35%;display:flex;justify-content: center;align-items:center;">
                    <div style="margin-right:18px;color:#ef7b7b;font-weight:bold;letter-spacing:3.5px">產品類別</div>
                    <select id="test" onchange="showCompanyList()" required>
                            <option value="" disabled selected hidden>
                                請選擇
                            </option>
                        </select>
                </div>
                <div style="outline:2px solid red;height:8%">
                </div>
            </div>
        </header>
        <div style="padding-top:16vh;display:flex">
            <aside style="width:35%;">
                <header class="subTitle textAll" style="outline:5px solid red;height:7vh;font-size:20px;display:flex;">
                    <div style="color:#ef7b7b;margin:auto">
                        推薦客戶
                    </div>
                </header>
                <div style="height:74.5vh;overflow-y: scroll;">
                    <div class="accordionItem" style="margin-bottom:10px;">
                        <div style="padding-left:13px;cursor:pointer;text-align: left;border-radius:3px;" onclick="toggleItem(event)" class="accordionHead">
                            高度推薦
                            <span id="hiLength" style="position:absolute;right:5px;background-color: #134272;padding: 2px 22px;border-radius: 15px;"></span>
                        </div>
                        <div class="accordionContent close" id="high" style="text-align:left;padding: 2px 0px;border: 1px solid #ddd">
                        </div>
                    </div>
                    <div class="accordionItem" style="margin-bottom:10px;">
                        <div style="padding-left:13px;cursor:pointer;text-align: left;border-radius:3px;" onclick="toggleItem(event)" class="accordionHead">
                            中度推薦
                            <span id="meLength" style="position:absolute;right:5px;background-color: #134272;padding: 2px 22px;border-radius: 15px;"></span>
                        </div>
                        <div class="accordionContent close" id="medium" style="text-align:left;padding: 2px 0px;border: 1px solid #ddd">
                        </div>
                    </div>
                    <div class="accordionItem" style="margin-bottom:10px;">
                        <div style="padding-left:13px;cursor:pointer;text-align: left;border-radius:3px;" onclick="toggleItem(event)" class="accordionHead">低度推薦
                            <span id="loLength" style="position:absolute;right:5px;background-color: #134272;padding: 2px 22px;border-radius: 15px;"></span>
                        </div>
                        <div class="accordionContent close" id="low" style="padding: 2px 0px;border: 1px solid #ddd">
                        </div>
                    </div>
                </div>
            </aside>
            <main style="width:65%;">
                <header class="subTitle textAll" style="outline:5px solid red;height:7vh;font-size:20px;display:flex;">
                    <div style="color:#ef7b7b;margin:auto">
                        客戶畫像
                    </div>
                </header>
                <div style="height:74.5vh;overflow-y: scroll;">
                    <div style="padding:25px 55px 0px 55px;outline:5px solid red;">
                        <div id="level" style="font-size:58px;text-align:center;">
                        </div>
                        <div id="id" style="text-align:center;margin-bottom:40px;">
                        </div>
                        <div style="margin-bottom:40px;">
                            <div id="basic" >

                            </div>
                        </div>
                        <div id="titleBetween">
                        </div>
                        <section id="similar" style="font-weight:100;margin-bottom:40px;">
                        </section>
                        <div id="titleNews">
                        </div>
                        <section >
                            <div id="newsTest" >

                            </div>
                        </section>
                    </div>
                </div>

            </main>
        </div>
    </div>
    <!-- </div> -->
    <script src="company.js"></script>
    <script>
        window.onload = () => {
            show()
        };
        // 幾筆推薦公司, 預設顯示為０
        const lengthArr = ['hiLength', 'meLength', 'loLength']
        for (let i in lengthArr) {
            let number = lengthArr[i]
            document.getElementById(number).textContent = 0
        }

        //打開關起功能
        const content = document.getElementsByClassName('accordionContent')

        function toggleItem(e) {
            let className = e.target.nextElementSibling.className //= this.parentNode.className
            for (let j in content) {
                content[j].className = 'accordionContent close';
            }
            if (className === 'accordionContent close') {
                e.target.nextElementSibling.className = 'accordionContent open'
            }
        }

        const filterArray = Object.keys(data2)
        //第1個filter
        function show() {
            for (let i in filterArray) {
                var node = document.createElement("OPTION");
                var textnode = document.createTextNode(filterArray[i]);
                node.appendChild(textnode);
                document.getElementById("test").appendChild(node);
            }
        }

        let filterResponse = ''

        //顯示 推薦客戶的list
        function showCompanyList() {
            //清空上一筆資料
            document.getElementById("high").textContent = ''
            document.getElementById("medium").textContent = ''
            document.getElementById("low").textContent = ''



            let a = document.getElementById("test").value
            filterResponse = a

            let hiLength = data2[filterResponse].list.hi.length
            let meLength = data2[filterResponse].list.me.length
            let loLength = data2[filterResponse].list.lo.length
            document.getElementById('hiLength').textContent = hiLength
            document.getElementById('meLength').textContent = meLength
            document.getElementById('loLength').textContent = loLength


            //抓資料出來
            let high = filterResponse in data2 ? data2[filterResponse].list.hi : null
            let medium = filterResponse in data2 ? data2[filterResponse].list.me : null
            let low = filterResponse in data2 ? data2[filterResponse].list.lo : null

            for (let i in high) {

                var node = document.createElement("DIV");
                var textnode = document.createTextNode(high[i]);

                //add id attribtue
                // https://stackoverflow.com/questions/19625646/javascript-adding-an-id-attribute-to-another-created-element
                node.setAttribute("id", "testid");
                node.setAttribute("style", "cursor:pointer");
                node.appendChild(textnode);

                //add onclick event to customer list
                // https://stackoverflow.com/questions/13915702/adding-event-listeners-to-multiple-elements
                node.addEventListener("click", CustomerProfile)
                document.getElementById("high").appendChild(node);
            }

            for (let i in medium) {
                var node = document.createElement("DIV");
                var textnode = document.createTextNode(medium[i]);
                node.setAttribute("id", "testid");
                node.setAttribute("style", "cursor:pointer");
                node.appendChild(textnode);
                node.addEventListener("click", CustomerProfile)
                document.getElementById("medium").appendChild(node);
            }

            for (let i in low) {
                var node = document.createElement("DIV");
                node.setAttribute("style", "cursor:pointer");
                var textnode = document.createTextNode(low[i]);
                node.setAttribute("id", "testid");
                node.appendChild(textnode);
                node.addEventListener("click", CustomerProfile)
                document.getElementById("low").appendChild(node);
            }
        }

        let profile = ''
        let similarContent

        function CustomerProfile(e) {
            let filterChoice = filterResponse
            let a = e.target.textContent //get the textcontent of element clicked
            profile = a in data2[filterResponse].profile ? data2[filterResponse].profile[a] : null
            //把資料放進 客戶畫像 裡面
            document.getElementById('level').textContent = profile.level
            document.getElementById('id').textContent = `ID:${profile.id}`

            // 把資料放進組織型態那一區
            showCustomer('basic')
            showCustomer('similar')

            //放進 相似公司資料
            // let similar = Object.keys(profile.similar)
            // for (let i in similar){
            //     let div = document.createElement("DIV")
            //     div.setAttribute("id", "similarStyle")
            //     let text = `${similar[i]}`
            //
            //     //test
            //     let iNode = document.createElement("I")
            //     iNode.setAttribute("class", "fas fa-info-circle")
            //     console.log('iNode is',iNode)
            //
            //     // let node = document.createElement("DIV")
            //     // <i class="fas fa-info-circle"></i>
            //
            //     div.innerHTML = text
            //     document.getElementById('similar').appendChild(div)
            //     document.getElementById('similar').appendChild(iNode)
            // }

            document.getElementById('newsTest').textContent = '' //先清空上一筆
            let news = profile.news
            let div
            for (let i in news) {  //5筆
                let node = document.createElement("DIV"); //create an element
                // let textnode = document.createTextNode(news[i]); //create text
                // node.appendChild(textnode); //append text to the element

                //test
                div = document.createElement("DIV")
                div.setAttribute("id", "testBorder")

                let title = document.createElement("DIV")
                title.setAttribute("id", "marginBelow")
                let text = `${news[i][0]}`
                title.innerHTML = text

                let content = document.createElement("DIV")
                let contentText = `${news[i][1]}`
                content.innerHTML = contentText

                div.appendChild(title)
                div.appendChild(content)
                //test
                document.getElementById("newsTest").appendChild(div); //append the element to html page
            }

        }

        //display '客戶畫像' contents
        function showCustomer(e) {
            document.getElementById(e).textContent = '' //先清空上一筆
            document.getElementById('titleBetween').textContent = '相似公司' //先清空上一筆
            document.getElementById('titleNews').textContent = '產訓新聞' //先清空上一筆

            let companyInfo = Object.keys(profile[e]) //profile底下的下一層選項的'basic'或'similar'底下的東西

            let basicTitle = ['組織型態：', '創立時間：', '行業：', '主要產品：']
            similarTitle = Object.keys(profile.similar)
            similarContent = profile.similar

            // test
            // for (let i in companyInfo) {
            //     let title = e === 'basic' ? basicTitle : tagTitle
            //     let p
            //     let key = companyInfo[i]
            //     let keyValue = profile[e][key]
            //     for (let j in title) {
            //         p = document.createElement("P")
            //         let text = `${title[j]}${keyValue}`
            //         p.innerHTML = text
            //     }
            //     document.getElementById(e).appendChild(p) //append the element to html page
            // }
            // // test



            // for (let i in companyInfo) {
            //     console.log('a')
            //     let title = e === 'basic' ? basicTitle : tagTitle
            //     let p
            //     for (let j in title) {
            //         p = document.createElement("P")
            //         let key = companyInfo[i]
            //         let keyValue = profile[e][key]
            //         console.log('title[i] is',title[i])
            //         let text = `${title[i]}${keyValue}`
            //         console.log('text is',text)
            //         p.innerHTML = text
            //     }
            //     console.log('c')
            //     document.getElementById(e).appendChild(p) //append the element to html page
            // }

            // <div>first then append sth inside
            for (let i in companyInfo) {
                let title = e === 'basic' ? basicTitle : similarTitle
                let p
                let div
                let info
                let key = companyInfo[i]
                for (let j in title) {

                    if( e === 'basic'){
                        // test
                        //div elements to hold the two divs inside
                        div = document.createElement("DIV")
                        div.setAttribute("id", "testStyle")

                        //test
                        divChild = document.createElement("DIV")
                        divChild.setAttribute("id", "testStyle2")
                        let before = `${title[i]}`
                        divChild.innerHTML = before


                        p = document.createElement("P")
                        let keyValue = profile[e][key]
                        let text = `${keyValue}`
                        p.innerHTML = text

                        div.appendChild(divChild)
                        div.appendChild(p)

                    } else {
                        // test
                        //div elements to hold the two divs inside
                        div = document.createElement("DIV")
                        div.setAttribute("id", "similarStyle")


                        //add info text
                        info = document.createElement("SPAN")
                        info.setAttribute("id", "info")
                        let text = profile[e][title[i]]
                        info.innerHTML = text



                        //test
                        divChild = document.createElement("SPAN")
                        divChild.setAttribute("id", "similarId")
                        let before = `${title[i]}`
                        divChild.innerHTML = before

                        //add event listener
                        divChild.addEventListener("mouseover", showCoords)
                        divChild.addEventListener("mouseout", disappear)


                        let iNode = document.createElement("I")
                        iNode.setAttribute("class", "fas fa-info-circle")
                        divChild.appendChild(iNode)

                        div.appendChild(divChild)
                        // div.appendChild(iNode)
                        div.appendChild(info)

                    }
                }
                document.getElementById(e).appendChild(div) //append the element to html page
            }

        }
        //tooptip內容與位置
        function showCoords(e){
            //tooltip位置
            let x = e.clientX
            let y = e.clientY
            let info = document.getElementById('info')
            info.style.visibility = 'visible'
            info.style.left = calc(x)
            info.style.top = calc(y)

            //硬幹,為了讓info icon也有字跑出
            let parent = event.target.parentElement
            info.textContent = parent.nodeName === 'SPAN'
            ? similarContent[parent.textContent] //tooptip內容
            : similarContent[event.target.textContent] //tooptip內容

        }
        const calc = (n) => `${n + 8}px`

        //mouseout時讓tooptip消失
        function disappear(){
            document.getElementById('info').style.visibility = 'hidden'
        }
    </script>

</body>

</html>
